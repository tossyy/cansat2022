# GPSモジュールドキュメント

## マイコン初期設定
以下のサイトの通りに行った。  
[Raspberry Piに「みちびき」対応GPSモジュールを接続](https://denor.jp/raspberry-piに「みちびき」対応gpsモジュールを接続)

> /boot/cmdline.txtを編集し、既存のdwc_ort.lpm_enableをコメントアウトして、コンソールをserial0からtty1に変更します。

については、`console=serial0,115200`をコメントアウトしただけ。

## Python環境構築
```
pip install pyserial
```
を実行し、シリアル通信ができるようにする。
`venv`で仮想環境を構築することをお勧めする。

勝部のRaspberryPiでは、
```
cd ~/utat
source can/bin/activate
```
により仮想環境を有効化できる。

## 生データ読み込み
初期設定で設定した通り、`/dev/ttyS0`にGPSにより取得したデータが入るので、シリアル通信によりデータを読み取り、出力する。
```
sudo python read_raw_data.py
```
を実行すると、以下のような結果が得られる。
```
$GPZDA,061240.000,07,06,2022,,*54

$GPGRS,061240.000,1,-4.65,-14.2,-5.21,81.3,,,,,,,,*5E

$GPGST,061240.000,00013,00078,00053,25.0,00075,00059,00140*51

$GPGGA,061241.000,3542.8990,N,13945.6642,E,1,4,2.49,2.4,M,39.3,M,,*5C

$GPGSA,A,3,17,06,04,19,,,,,,,,,2.69,2.49,1.00*0D

$GPRMC,061241.000,A,3542.8990,N,13945.6642,E,0.97,141.46,070622,,,A*63

$GPZDA,061241.000,07,06,2022,,*55

$GPGRS,061241.000,1,-3.65,-12.9,-4.77,84.3,,,,,,,,*52

$GPGST,061241.000,00013,00079,00053,24.9,00075,00059,00141*58
```

## フォーマットデータ読み込み
読み込んだ生データを、わかりやすい形にフォーマットする。以下のサイトを参考に行った。
[Raspberry Pi3のPythonでGPSを扱う](https://ambidata.io/blog/2017/08/02/gps/)
```
sudo python read_formatted_data.py
```
を実行すると、以下のような結果が得られる。
```
15:07:54.0
緯度経度: 35.71554667, 139.76129000
海抜: 101.700000
[3, 14, 17, 19, 6, 4]
衛星番号: (仰角, 方位角, SN比)
19: (78, 311, 15)
17: (77, 154, 16)
6: (50, 315, 21)
4: (39, 82, 14)
3: (27, 45, 19)
11: (16, 286, None)
14: (13, 196, 16)
2: (13, 291, None)
12: (12, 315, None)
1: (9, 88, None)
193: (None, None, None)
194: (None, None, None)
195: (None, None, None)

15:07:57.0
緯度経度: 35.71553000, 139.76130500
海抜: 101.700000
[3, 14, 17, 19, 6, 4]
衛星番号: (仰角, 方位角, SN比)
19: (78, 311, 17)
17: (77, 154, 14)
6: (50, 315, 22)
4: (39, 82, 16)
3: (27, 45, 17)
11: (16, 286, None)
14: (13, 196, 15)
2: (13, 291, None)
12: (13, 315, None)
1: (9, 88, None)
193: (None, None, None)
194: (None, None, None)
195: (None, None, None)
```

フォーマッターを[Github](https://github.com/inmcm/micropyGPS)からダウンロードし、`micropyGPS.py`を`read_formatted_data.py`と同じディレクトリに置く必要がある。